<!--
    GitHub Pages에 배포하기 위한 index.html 파일입니다.
    가을 느낌이 나는 따뜻한 옐로우 톤의 색상 팔레트가 적용되었습니다.
-->
<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>생성형 AI 에이전트 연수과정 학습 시스템</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /*
            Tailwind CSS를 사용하여 스타일링을 진행했습니다.
            가을 느낌이 나는 따뜻한 옐로우 계열의 색상 팔레트를 정의했습니다.
        */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
        }
        /* 가을 옐로우 계열 색상 팔레트 */
        .pastel-bg-light { background-color: #fcfbeb; }
        .pastel-bg { background-color: #f7e6a7; }
        .pastel-accent { background-color: #f0c419; }
        .pastel-accent-hover { background-color: #e6b90f; }
        .text-yellow-800 { color: #8a6c0e; }
        .bg-yellow-50 { background-color: #fcfbeb; }
        .bg-yellow-500 { background-color: #f0c419; }
        .bg-yellow-400 { background-color: #f4d048; }
        .bg-yellow-600 { background-color: #e6b90f; }
        .border-yellow-200 { border-color: #f8e9a6; }
        .text-red-600 { color: #e53e3e; }
        .text-green-600 { color: #38a169; }

        /* 로딩 스피너 애니메이션 */
        .spinner {
            border-top-color: #e6b90f;
            -webkit-animation: spin 1s infinite linear;
            animation: spin 1s infinite linear;
        }
        @-webkit-keyframes spin {
            0% { -webkit-transform: rotate(0deg); }
            100% { -webkit-transform: rotate(360deg); }
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* 가독성 향상 스타일 */
        #content-text, #quiz-container {
            font-size: 1.125rem; /* text-lg */
            line-height: 1.8; /* Increased line-height for better spacing */
        }
    </style>
</head>
<body class="bg-yellow-50 text-gray-800 antialiased min-h-screen flex flex-col">
    <header class="bg-yellow-500 text-white p-8 text-center shadow-lg">
        <h1 class="text-3xl sm:text-4xl md:text-5xl font-bold">생성형 AI 에이전트 연수과정 학습 시스템</h1>
        <p class="mt-2 text-md sm:text-lg">연수 계획서 기반의 필수 학습 내용을 미리 알아보고 준비하세요.</p>
    </header>

    <main class="flex-grow p-4 md:p-8 max-w-7xl mx-auto w-full">
        <!-- 학습 모듈 카드 섹션 -->
        <section id="module-container" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
            <!-- JavaScript가 여기에 학습 모듈 카드를 동적으로 추가합니다. -->
        </section>

        <!-- 학습 내용 표시 섹션 -->
        <section id="content-display" class="hidden bg-white rounded-xl shadow-lg p-6 sm:p-8 md:p-10 transition-all duration-300 ease-in-out">
            <button id="back-btn" class="mb-6 flex items-center text-yellow-600 font-medium">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 mr-2" viewBox="0 0 20 20" fill="currentColor">
                    <path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" />
                </svg>
                뒤로가기
            </button>
            <h2 id="content-title" class="text-2xl sm:text-3xl font-bold text-yellow-800 mb-4"></h2>
            <div id="content-text" class="prose max-w-none text-gray-700 mb-8">
                <!-- 동적으로 생성된 학습 내용이 여기에 표시됩니다. -->
            </div>

            <!-- 학습 확인 문제 섹션 -->
            <div id="quiz-section" class="mt-8 pt-8 border-t-2 border-gray-200">
                <h3 class="text-xl font-bold text-yellow-800 mb-4">학습 확인 문제</h3>
                <button id="generate-quiz-btn" class="bg-yellow-400 text-white font-medium py-3 px-6 rounded-lg shadow-md hover:bg-yellow-500 transition-colors">문제 생성하기</button>
                
                <div id="quiz-container" class="mt-6 p-6 rounded-lg bg-yellow-50 border border-yellow-200 hidden">
                    <!-- 문제가 동적으로 여기에 추가됩니다. -->
                </div>

                <!-- 로딩 인디케이터 (퀴즈용) -->
                <div id="quiz-loading-indicator" class="flex flex-col items-center justify-center p-8 hidden">
                    <div class="spinner h-12 w-12 border-4 border-gray-300 rounded-full"></div>
                    <p class="mt-4 text-gray-600 font-medium">문제를 생성하고 있습니다...</p>
                </div>
                
                <div id="quiz-error-message" class="text-red-500 text-center mt-4 hidden">
                    <p>죄송합니다. 문제를 불러오는 데 실패했습니다. 잠시 후 다시 시도해주세요.</p>
                </div>
            </div>

            <!-- 로딩 인디케이터 (학습 내용용) -->
            <div id="loading-indicator" class="flex flex-col items-center justify-center p-8 hidden">
                <div class="spinner h-12 w-12 border-4 border-gray-300 rounded-full"></div>
                <p class="mt-4 text-gray-600 font-medium">내용을 생성하고 있습니다...</p>
            </div>
            <!-- API 오류 메시지 (학습 내용용) -->
            <div id="error-message" class="text-red-500 text-center mt-4 hidden">
                <p>죄송합니다. 내용을 불러오는 데 실패했습니다. 잠시 후 다시 시도해주세요.</p>
            </div>
        </section>
    </main>

    <script>
        //
        // 클라이언트 측 JavaScript: Gemini API를 직접 호출하도록 수정되었습니다.
        // 이 코드는 로컬 환경에서 테스트하기 용이하도록 작성되었으며, Apps Script 환경에서는
        // Google Apps Script의 서버 함수를 호출하는 방식으로 다시 변경해야 합니다.
        //
        document.addEventListener('DOMContentLoaded', () => {
            const moduleContainer = document.getElementById('module-container');
            const contentDisplay = document.getElementById('content-display');
            const contentTitle = document.getElementById('content-title');
            const contentText = document.getElementById('content-text');
            const loadingIndicator = document.getElementById('loading-indicator');
            const errorMessage = document.getElementById('error-message');
            const backBtn = document.getElementById('back-btn');
            const generateQuizBtn = document.getElementById('generate-quiz-btn');
            const quizContainer = document.getElementById('quiz-container');
            const quizLoadingIndicator = document.getElementById('quiz-loading-indicator');
            const quizErrorMessage = document.getElementById('quiz-error-message');

            let currentQuizData = null; // 현재 문제를 저장할 변수

            const modules = [
                {
                    title: "기초 프로그래밍 (Python)",
                    description: "Python의 기본 문법, 변수, 자료형, 함수, 객체 지향 프로그래밍(OOP) 개념을 학습합니다.",
                    url: "https://www.w3schools.com/python/default.asp",
                    isInternal: false
                },
                {
                    title: "머신러닝 기초",
                    description: "지도/비지도 학습, 모델의 학습 및 평가 과정, 주요 알고리즘의 기본 원리를 이해합니다.",
                    url: "https://developers.google.com/machine-learning/crash-course?hl=ko",
                    isInternal: false
                },
                {
                    title: "자연어 처리(NLP) 개념",
                    description: "텍스트 데이터의 전처리, 토큰화, 단어 임베딩, 그리고 Transformer 아키텍처의 기본 원리를 알아봅니다.",
                    url: "https://huggingface.co/learn/nlp-course/ko/chapter1/1",
                    isInternal: false
                },
                {
                    title: "CAFA 플랫폼 및 에이전트 개념",
                    description: "CAFA 플랫폼의 로우코드 환경과 온톨로지 모델 중심 생성(OMG) 방식의 개념을 이해합니다.",
                    url: "#",
                    isInternal: true,
                    prompt: "CAFA 플랫폼의 로우코드 환경과 온톨로지 모델 중심 생성(OMG) 방식의 개념에 대해 연수 계획서 내용을 바탕으로 자세히 설명해줘. 주요 특징과 목적을 포함해줘."
                },
                {
                    title: "단일 턴/복수 턴 에이전트",
                    description: "단일 상호작용 및 복잡한 대화 흐름을 처리하는 에이전트 개발 실습 내용을 미리 살펴봅니다.",
                    url: "#",
                    isInternal: true,
                    prompt: "단일 턴(Single-Turn) 에이전트와 복수 턴(Multi-Turn) 에이전트의 개념과 차이점을 연수 계획서의 실습 예시를 참고하여 설명해줘. '에이전트 내 집단 AI'의 의미도 포함해줘."
                },
                {
                    title: "반복문 활용 에이전트",
                    description: "특정 조건이 충족될 때까지 턴을 반복하는 동적인 상호작용 에이전트의 원리를 알아봅니다.",
                    url: "#",
                    isInternal: true,
                    prompt: "연수 계획서에 나온 반복문(Looping Mechanism) 활용 에이전트의 개념과 실습 예시(적응형 문제 생성기, 루브릭 생성기)에 대해 자세히 설명해줘. 반복문이 어떻게 동작하는지 설명해줘."
                },
                {
                    title: "OMG (온톨로지 모델)",
                    description: "온톨로지 모델을 활용하여 지식 기반의 정확하고 설명 가능한 콘텐츠를 생성하는 방법을 파악합니다.",
                    url: "#",
                    isInternal: true,
                    prompt: "OMG(Ontology Model-centered Generation)의 개념과 이점을 연수 계획서 내용을 바탕으로 설명해줘. 온톨로지 모델의 정의, 구조적 유형, 그리고 기존 방식(LOG, RAG)과의 차이점을 중심으로 설명해줘."
                },
                {
                    title: "오케스트레이션 에이전트",
                    description: "여러 에이전트를 조율하여 복합적인 작업을 수행하고 개인 맞춤형 학습 경로를 설계하는 개념을 이해합니다.",
                    url: "#",
                    isInternal: true,
                    prompt: "오케스트레이션 에이전트의 개념과 '에이전트 간 집단 AI'의 의미를 설명해줘. 연수 계획서의 실습 예시(개인 맞춤형 학습 경로 오케스트레이터)를 참고하여 여러 에이전트가 어떻게 협업하는지 구체적으로 설명해줘."
                }
            ];
            
            // NOTE: 이 API 키는 Apps Script 환경에서 보안상 민감할 수 있으므로,
            // Apps Script 배포 시에는 Code.gs 파일에만 저장해야 합니다.
            // 로컬 테스트를 위해 임시로 여기에 포함합니다.
            const API_KEY = ""; 

            // API 호출 함수
            async function fetchGeminiContent(prompt) {
                loadingIndicator.classList.remove('hidden');
                errorMessage.classList.add('hidden');
                contentText.innerHTML = '';
                
                try {
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { contents: chatHistory };
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`API error: ${response.statusText}`);
                    }
                    
                    const result = await response.json();
                    
                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const text = result.candidates[0].content.parts[0].text;
                        contentText.innerHTML = marked.parse(text);
                    } else {
                        throw new Error('Invalid API response structure');
                    }
                } catch (error) {
                    console.error("Error fetching content:", error);
                    errorMessage.classList.remove('hidden');
                } finally {
                    loadingIndicator.classList.add('hidden');
                }
            }

            // 퀴즈 API 호출 함수
            async function fetchQuizContent(moduleTitle) {
                quizLoadingIndicator.classList.remove('hidden');
                quizContainer.classList.add('hidden');
                quizErrorMessage.classList.add('hidden');

                try {
                    const prompt = `${moduleTitle}의 내용을 바탕으로 학습 내용을 점검할 수 있는 3~5개의 객관식 문제들을 출제하고, 각 문제의 정답과 해설을 포함하여 JSON 배열 형식으로 반환해줘. 정답과 해설은 반드시 한글로 작성해줘. JSON 배열의 각 객체는 다음과 같아: { "question": "...", "options": ["...", "...", "...", "..."], "answer": "...", "explanation": "..." }`;
                    
                    let chatHistory = [];
                    chatHistory.push({ role: "user", parts: [{ text: prompt }] });
                    const payload = { 
                        contents: chatHistory,
                        generationConfig: {
                            responseMimeType: "application/json"
                        }
                    };
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${API_KEY}`;
                    
                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API error: ${response.statusText}`);
                    }

                    const result = await response.json();

                    if (result.candidates && result.candidates.length > 0 &&
                        result.candidates[0].content && result.candidates[0].content.parts &&
                        result.candidates[0].content.parts.length > 0) {
                        const jsonText = result.candidates[0].content.parts[0].text;
                        currentQuizData = JSON.parse(jsonText);
                        quizContainer.classList.remove('hidden');
                        quizContainer.innerHTML = ''; // 기존 문제 제거

                        currentQuizData.forEach((quiz, index) => {
                            const quizItem = document.createElement('div');
                            quizItem.className = 'quiz-item mb-6 p-4 rounded-lg bg-yellow-50 border border-yellow-200';
                            quizItem.innerHTML = `
                                <p class="font-semibold text-gray-800 mb-2">Q${index + 1}. ${quiz.question}</p>
                                <div class="quiz-options flex flex-col space-y-2 mb-2">
                                    ${quiz.options.map((option, optIndex) => `
                                        <label class="flex items-center text-gray-700 cursor-pointer">
                                            <input type="radio" name="quiz-${index}" value="${option}" class="mr-2">
                                            <span>${option}</span>
                                        </label>
                                    `).join('')}
                                </div>
                                <button class="submit-quiz-btn bg-yellow-600 text-white font-medium py-2 px-4 rounded-lg shadow-md hover:bg-yellow-700 transition-colors mt-2">정답 제출</button>
                                <p class="quiz-feedback mt-2 font-bold text-lg"></p>
                                <button class="show-explanation-btn text-yellow-600 mt-2 hover:underline hidden">해설 보기</button>
                                <div class="quiz-explanation mt-2 text-gray-600 italic hidden">${quiz.explanation}</div>
                            `;
                            quizContainer.appendChild(quizItem);
                        });

                        // 각 문제에 대한 이벤트 리스너 추가
                        quizContainer.querySelectorAll('.quiz-item').forEach((quizItem, index) => {
                            const submitBtn = quizItem.querySelector('.submit-quiz-btn');
                            const feedback = quizItem.querySelector('.quiz-feedback');
                            const showExplanationBtn = quizItem.querySelector('.show-explanation-btn');
                            const explanation = quizItem.querySelector('.quiz-explanation');
                            
                            submitBtn.addEventListener('click', () => {
                                const selectedOption = quizItem.querySelector(`input[name="quiz-${index}"]:checked`);
                                if (selectedOption) {
                                    if (selectedOption.value === currentQuizData[index].answer) {
                                        feedback.textContent = "정답입니다! 🎉";
                                        feedback.className = "mt-2 font-bold text-lg text-green-600";
                                    } else {
                                        feedback.textContent = "오답입니다. 다시 시도해보세요.";
                                        feedback.className = "mt-2 font-bold text-lg text-red-600";
                                    }
                                    submitBtn.classList.add('hidden');
                                    showExplanationBtn.classList.remove('hidden');
                                } else {
                                    feedback.textContent = "선택지를 골라주세요.";
                                    feedback.className = "mt-2 font-bold text-lg text-yellow-600";
                                }
                            });
                            
                            showExplanationBtn.addEventListener('click', () => {
                                explanation.classList.toggle('hidden');
                            });
                        });
                    } else {
                        throw new Error('Invalid API response structure');
                    }
                } catch (error) {
                    console.error("Error fetching quiz content:", error);
                    quizErrorMessage.classList.remove('hidden');
                } finally {
                    quizLoadingIndicator.classList.add('hidden');
                }
            }


            // 모듈 카드 동적 생성
            modules.forEach(module => {
                const card = document.createElement('div');
                card.className = 'module-card bg-white rounded-xl shadow-md p-6 flex flex-col justify-between transform transition-transform hover:scale-105';
                card.innerHTML = `
                    <h2 class="text-xl font-semibold text-yellow-800 mb-2">${module.title}</h2>
                    <p class="flex-grow text-gray-600 mb-4">${module.description}</p>
                    <a href="${module.url}" target="${module.isInternal ? '_self' : '_blank'}" class="learn-btn bg-yellow-400 text-white font-medium py-3 px-6 rounded-lg text-center shadow-md hover:bg-yellow-500 transition-colors">${module.isInternal ? '내용 보기' : '학습하기'}</a>
                `;
                moduleContainer.appendChild(card);
            });

            // 이벤트 위임을 사용하여 '내용 보기' 버튼 클릭 이벤트 처리
            moduleContainer.addEventListener('click', (e) => {
                if (e.target.classList.contains('learn-btn')) {
                    e.preventDefault();
                    const moduleIndex = Array.from(moduleContainer.children).findIndex(child => child.contains(e.target));
                    const module = modules[moduleIndex];

                    if (module.isInternal) {
                        moduleContainer.classList.add('hidden');
                        contentDisplay.classList.remove('hidden');
                        contentTitle.textContent = module.title;
                        
                        // Apps Script 환경이 아닐 경우, 로컬 API 호출
                        // Apps Script 환경이라면 google.script.run을 사용합니다.
                        fetchGeminiContent(module.prompt);
                    } else {
                        window.open(module.url, '_blank');
                    }
                }
            });

            // '문제 생성하기' 버튼 클릭 이벤트 처리
            generateQuizBtn.addEventListener('click', () => {
                const currentTitle = contentTitle.textContent;
                const module = modules.find(m => m.title === currentTitle);
                
                if (module) {
                     // Apps Script 환경이 아닐 경우, 로컬 API 호출
                    // Apps Script 환경이라면 google.script.run을 사용합니다.
                    fetchQuizContent(module.title);
                }
            });

            // 뒤로가기 버튼 클릭 이벤트
            backBtn.addEventListener('click', () => {
                contentDisplay.classList.add('hidden');
                moduleContainer.classList.remove('hidden');
                contentText.innerHTML = '';
                quizContainer.classList.add('hidden');
                generateQuizBtn.classList.remove('hidden');
            });

            // marked 라이브러리 로드 (마크다운 렌더링을 위해)
            const script = document.createElement('script');
            script.src = "https://cdn.jsdelivr.net/npm/marked/marked.min.js";
            document.head.appendChild(script);
        });
    </script>
</body>
</html>

